# .github/workflows/init.yml
name: Initialize Template

#
# Run this on creation of a branch or ref
#
on:
  push:
    branches: main

jobs:
  build:
    #
    # Change this to make sure your workflow doesn't initialize on your template!
    #
    # if: github.repository != 'nFinus/template-init-test'

    runs-on: ubuntu-latest
    steps:
      - name: Check out Git repository
        uses: actions/checkout@v2

      #
      # Check if there is a template recipe
      #
      - id: template_exists
        name: Check template
        uses: andstor/file-existence-action@v1
        with:
          files: .tmplr.yml

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: 16
      
      - name: Install jq
        id: install-jq
        shell: bash
        run: |
          mkdir -p ${HOME}/.local/bin
          wget https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64 -O ${HOME}/.local/bin/jq
          chmod +x ${HOME}/.local/bin/jq
          echo "::set-output name=jq-binary::${HOME}/.local/bin/jq"

      - name: Get repo description
        run: |
          echo 'REPO_DESCRIPTION<<EOF' >> $GITHUB_ENV
          curl -s https://api.github.com/repos/ruby/ruby | jq -r '.description' >> $GITHUB_ENV
          echo 'EOF' >> $GITHUB_ENV

          curl -s https://api.github.com/repos/ruby/ruby | jq -r '.description'
          echo "{environment_variable_name}={value}" >> $GITHUB_ENV

      - run: echo "${{ env.REPO_DESCRIPTION }}"
      #
      # Run tmplr with required environment variables,
      # and remove the template recipe afterwards.
      #
      # Use this to get all the values you want from GitHub Action contexts
      # and set them as environment variables for tmplr.
      #
      # - name: Apply template
      #   if: steps.template_exists.outputs.files_exists == 'true'
      #   run: npx tmplr && rm -fr .tmplr.yml && rm -fr .github/workflows/init.yml
      #   env:
      #     owner_name: ${{ github.event.repository.owner.name }}
      #     owner_email: ${{ github.event.repository.owner.email }}
      #     repo_name: ${{ github.event.repository.name }}
      #     repo_url: ${{ github.event.repository.ssh_url }}

      # #
      # # Commit the code
      # #
      # - uses: EndBug/add-and-commit@v9
      #   with:
      #     message: Initialize from template